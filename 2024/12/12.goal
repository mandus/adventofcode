#!/usr/bin/env goal
fn:"input.txt"
(2=#ARGS) and fn:ARGS@1
v:""\"."/(w:1+&*v)v:=-read fn

n:(-w;-1;1;w)
vst:(#v)#0
gr:(,".")!(,0)
nxt:{[x;l]N:x+´n;N:((-1+#v)<)^((0>)^N);N@&(l=)v N}
addgrp:{[g;l;x] vst[x]and:0;vst[x]:1;gr[g],:x;:o[g;l]'nxt[x;l]}
over:{vst[x]and:0;vst[x]:1;l:v x;(l~".")and:0;gr[x]:,x; addgrp[x;l]'nxt[x;l]}
over'!#v
r:{?["."~x;0;#gr x]}'!gr
p:{?["."~x;0;+/({v:gr x; 4-+/(y+´n)¿v} x)'gr x]}'!gr
say "p1",+/r*p
say gr

